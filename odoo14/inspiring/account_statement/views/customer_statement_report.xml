<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<template id="report_customer_statement">
			<t t-call="web.external_layout">
				<style>
                    .table.table-sm {
                    position: relative;
                    top: 40px;
                    }
                    .table.table-sm thead tr {
                    background: #2b378e !important;
                    }
                    .table.table-sm thead tr strong {
                    color: white !important;
                    }
                    .table.table-sm tbody tr {
                    background: white !important;
                    }
                    .table.table-sm tbody td {
                    color: #000;
                    }
                    .table.table-sm, .table.table-sm td, .table.table-sm th {
                    border: 2px solid #bfbfbf;
                    }
                    .table.table-sm td, .table.table-sm th {
                    text-align: center;
                    height: auto !important;
                    }
                    .header-div {
                    width: 100%;
                    position: relative;
                    margin-bottom: 20px;
                    margin-top: 80px;
                    padding-bottom: 20px;
                    min-height: 130px;
                    }
                    .header-div #o_name {
                    float: right;
                    width: 45%;
                    position: absolute;
                    right: 0;
                    bottom: 0px;
                    /*padding-top: 50px;*/
                    text-align: right;
                    }
                    .header-div .contact-info {
                    float:left;
                    width: 45%;
                    color: black;
                    font-size: 1.2em;
                    }
                    #report_title {
                    color: #2b378e;
                    text-align: center;
                    font-weight: bold;
                    }
                    .stamp-container {
                    width: 100%;
                    text-align: right;
                    position: relative;
                    top: 150px;
                    padding-right: 80px;
                    }
                    .stamp-container strong {
                    color: black !important;
                    font-size: 1.1em;
                    }
                    .article {
                    position: relative;
                    }
                    .last-section {
                    width: 100%;
                    position: relative;
                    bottom: 0px;
                    margin-top: 360px;
                    }
                    .last-section .stamp-statement {
                    font-size: 0.8em;
                    color: black;
                    width: 100%;
                    text-align: right;
                    }
                    .last-section .delivery-details {
                    padding-bottom: 10px;
                    margin-top: 10px;
                    border-top: 1px solid #bfbfbf;
                    width: 90%;
                    }
                    .last-section .delivery-details .delivery-main-title {
                    margin-bottom: 20px;
                    }
                    .last-section .delivery-details .delivery-main-title strong {
                    font-size: 1.5em;
                    color: #2b378e;
                    }
                    .last-section .delivery-details .delivery-main-content > div {
                    border-right: 1px solid #bfbfbf;
                    }
                    .last-section .delivery-details .delivery-main-content > div:last-child {
                    border-right: 0;
                    }
                    .last-section .delivery-details .delivery-main-content strong,
                    .last-section .delivery-details .delivery-main-content .delivery-content {
                    color: black;
                    font-size: 1em;
                    }
                </style>
				<t t-set="doc" t-value="o.with_context({'lang':o.lang})" />
				<t t-set="company" t-value="res_company"/>

				<div class="text-right" style="margin-right: 15em;">
					<p><span t-esc="doc.name" /><br/>
						<span t-esc="doc.street" /><br/>
						<span t-esc="doc.street2" /><br/>
						<span t-esc="doc.city" />
						<span t-esc="doc.state_id.name" />
						<span t-esc="doc.zip" /><br/>
						<span t-esc="doc.country_id.name" /> 
					</p>
					
					<br/>
				</div>
				<div class="page">
					<t t-set="i" t-value="0.0" />
					<t t-set="j" t-value="0.0" />
					<t t-set="k" t-value="0.0" />
					<t t-foreach="doc.balance_invoice_ids" t-as="line">
						<t t-set="i" t-value="i+ line.amount_total_signed" />
						<t t-set="j" t-value="j+line.credit_amount" />
						<t t-set="k" t-value="k+line.result" />
					</t>
					<table class="table table-sm">
						<thead>
							<tr class="text-center">
								<th style="color: white !important;width: 25% !important;">Date</th>
								<th style="color: white !important;width: 15% !important;">Invoice Number</th>
								<th style="color: white !important;width: 10% !important;">Account</th>
								<th style="color: white !important;width: 10% !important;">Ref</th>
								<th style="color: white !important;width: 15% !important;">Invoices/Debit</th>
								<th style="color: white !important;width: 15% !important;">Payments/Credit</th>
								<th style="color: white !important;width: 10% !important;">Balance</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td></td>
								<td>
									<b>Initial Balance</b>
								</td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td class="text-right">
									<b><span t-esc="0.0" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></b>
								</td>
							</tr>
   							<t t-set="grand_total" t-value="0.0" />    
							<t t-set="bal" t-value="0.0" />
							<t t-set="sub_total" t-value="0.0" />
							<tr t-foreach="doc.balance_invoice_ids.sorted(key=lambda r: r.name)" t-as="line">
								<t t-set="bal" t-value="bal +sub_total "/>
									<td style="width: 25% !important;">
										<span t-esc="line.invoice_date" />
									</td>
									<td style="width: 15% !important;">
										<span t-esc="line.name" />
									</td>
									<td style="width: 10% !important;"> 
										<span t-esc="line.partner_id.property_account_receivable_id.code" />
									</td>
									<td style="width: 10% !important;"> 
										<span t-esc="line.name" />
									</td>
									<td class="text-right" style="width: 15% !important;">
										<span t-esc="line.amount_total_signed"
											t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}" />
									</td>
									<td class="text-right" style="width: 15% !important;">
										<span t-esc="line.credit_amount"
											t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}" />
									</td>
									<td class="text-right" style="width: 10% !important;">
										 <t t-set="sub_total" t-value="line.amount_total_signed-line.credit_amount" />
										 <t t-set="grand_total" t-value="sub_total + bal"/>
										<span t-esc="sub_total + bal"
											t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}" />
									</td>
							</tr>
							<tr>
								<td></td>
								<td>
									<b>Ending Balance</b>
								</td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td class="text-right">
									<b><span t-esc="grand_total" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></b>
								</td>
							</tr>
							<tr>
								<td class="text-right"></td>
								<td></td>
								<td></td>
								<td></td>
								<td class="text-right"><span t-esc="'%.3f'%(i)" /></td>
								<td class="text-right"><span t-esc="'%.3f'%(j)" /></td>
								<td class="text-right"><span t-esc="'%.3f'%(k)" /></td> 
							</tr>
						</tbody>
					</table>
		
					<div class="col-xs-4 pull-right ">
						<table class="table table-sm">
							<tr class="border-black">
								<td>
									<strong>Total Amount OverDue :</strong>
								</td>
								<td class="text-right">
									<strong>
										<span t-esc="doc.payment_amount_overdue_amt"
											t-options='{"widget": "monetary", "display_currency": res_company.currency_id}' />
									</strong>
								</td>
							</tr>
							<tr class="border-black">
								<td>
									<strong>Balance Due :</strong>
								</td>
								<td class="text-right">
									<strong>
										<span t-esc="doc.payment_amount_due_amt"
											t-options='{"widget": "monetary", "display_currency": res_company.currency_id}' />
									</strong>
								</td>
							</tr>
						</table> 
					</div>
					<br/>
								
					<table t-attf-class="table table-sm" name="days_table">
						<thead>
							<tr >
								<th style="color: white !important;"></th>
								<th style="color: white !important;">0-30</th>
								<th style="color: white !important;">30-60</th>
								<th style="color: white !important;">60-90</th>
								<th style="color: white !important;">90+</th>
								<th style="color: white !important;">Total</th>
							</tr>
						</thead>
						<tr>
							<td></td>
							<td><span t-esc="doc.first_thirty_day" /></td>
							<td><span t-esc="doc.thirty_sixty_days" /></td>
							<td><span t-esc="doc.sixty_ninty_days" /></td>
							<td><span t-esc="doc.ninty_plus_days" /></td>
							<td><span t-esc="doc.total" /></td>
						</tr>
					</table>
				</div>
			</t>
		</template>

		<template id="report_customer">
			<t t-call="web.html_container">
				<t t-foreach="docs" t-as="o">
					<t t-call="account_statement.report_customer_statement" t-lang="o.lang" />
				</t>
			</t>
		</template>
	</data>
</openerp>
